---
title: Getting Started
sidebar_position: 0
---

An implementation of i18next's [filesystem backend] for Sapphire. It allows you to use a JSON-based `languages`
directory to add internationalization for your bot using `SapphireClient`'s `fetchLanguage` hook and a custom message
extension, adding features such as `sendTranslated` and `resolveKey`.

[filesystem backend]: https://github.com/i18next/i18next-fs-backend

## Installation

```bash npm2yarn2pnpm
npm install @sapphire/plugin-i18next @sapphire/framework discord.js
```

## Usage

This registers the methods and options necessary for message translations in the Sapphire client.

<Tabs groupId="language-choice">
<TabItem value="javascript" label="JavaScript" default>

```javascript
// Main bot file
// Be sure to register the plugin before instantiating the client.
require('@sapphire/plugin-i18next/register');
```

</TabItem>
<TabItem value="esm" label="ESM">

```javascript
// Main bot file
// Be sure to register the plugin before instantiating the client.
import '@sapphire/plugin-i18next/register';
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript
// Main bot file
// Be sure to register the plugin before instantiating the client.
import '@sapphire/plugin-i18next/register';
```

</TabItem>
</Tabs>

## Get the language set per server

To obtain the language that each server has configured, as well as the custom prefixes for each server, for that we will
have now an option called `i18n` in the Sapphire client options, in which we will do the following.

```typescript ts2esm2cjs|{3}|{3}
import { SapphireClient } from '@sapphire/framework';
import { InternationalizationContext } from '@sapphire/plugin-i18next';

const client = new SapphireClient({
  intents: ['GUILDS', 'GUILD_MESSAGES'],
  i18n: {
    fetchLanguage: async (context: InternationalizationContext) => {
      if (!context.guild) return process.env.DEFAULT_LOCALE;
      const guildSettings = await db.find({ guild_id: context.guildId });
      return guildSettings.locale;
    }
  }
});

client.login('your-token-goes-here');
```

In the `fetchLanguage` option inside the `i18n` configuration object we can put our logic to get the language configured
for that server, in this example we check if the command comes from a server, and if not, then return the default
language, and then query for the server options and get the language configured for that server. The language obtained
in that method will be used to display the messages of the `i18next` plugin methods.

Something important to keep in mind is that you have to make sure that the language exists in your language directory,
otherwise an error will be thrown saying that the language obtained from the server is not valid.

The name of the languages configured in the i18n plugin will depend on the names of the language folders in your
language directory, for example:

```
├── commands
├── listeners
└── languages
    └── en-US
        └── ping.json
        └── misc.json
    └── es-ES
        └── ping.json
        └── misc.json
```

In this case we have the languages `en-US`, `es-ES`, remember that the languages must be in the directory called
`languages` in the root folder of your project, as well as the other pieces like `commands,` `listeners`, etc. Inside
the language folders we will put our files, namespaces to use in the translation of messages.

The basic structure of a translation file is as follows:

<!--- languages/en-US/commands/ping.json --->

```json
{
  "success": "Pong!",
  "success_with_args": "Pong! Took me {{latency}}ms to reply"
}
```

The `resolveKey` function can be used anywhere to get translated text by its key. In this example, it is used in a
method to send a message.

```typescript ts2esm2cjs|{13}|{13}
import { resolveKey } from '@sapphire/plugin-i18next';
import { Command } from '@sapphire/framework';

export class PingCommand extends Command {
  public constructor(context: Command.Context, options: Command.Options) {
    super(context, {
      ...options,
      description: 'ping pong'
    });
  }

  public async messageRun(message: Message) {
    await message.channel.send(await resolveKey('commands/ping:success'));
  }
}
```

`sendLocalized` will send translated text resolved from a key to a specified channel.

```typescript ts2esm2cjs|{13}|{13}
import { sendLocalized } from '@sapphire/plugin-i18next';
import { Command } from '@sapphire/framework';

export class PingCommand extends Command {
  public constructor(context: Command.Context, options: Command.Options) {
    super(context, {
      ...options,
      description: 'ping pong'
    });
  }

  public async messageRun(message: Message) {
    await sendLocalized(message, 'commands/ping:success');
  }
}
```

`editLocalized` edits a message, replacing its content with translated text resolved from its key.

```typescript ts2esm2cjs|{13}|{13}
import { editLocalized } from '@sapphire/plugin-i18next';
import { Command } from '@sapphire/framework';

export class PingCommand extends Command {
  public constructor(context: Command.Context, options: Command.Options) {
    super(context, {
      ...options,
      description: 'ping pong'
    });
  }

  public async messageRun(message: Message) {
    await editLocalized(message, 'commands/ping:success_args', { latency: ws.ping });
  }
}
```

`replyLocalized` replies to a message, sending the text resolved from its key.

```typescript ts2esm2cjs|{13}|{13}
import { replyLocalized } from '@sapphire/plugin-i18next';
import { Command } from '@sapphire/framework';

export class PingCommand extends Command {
  public constructor(context: Command.Context, options: Command.Options) {
    super(context, {
      ...options,
      description: 'ping pong'
    });
  }

  public async messageRun(message: Message) {
    await replyLocalized(message, 'commands/ping:success_args', { latency: ws.ping });
  }
}
```

`fetchLanguage` returns the guild-specific language that the client is using.

```typescript ts2esm2cjs|{13}|{13}
import { fetchLanguage } from '@sapphire/plugin-i18next';
import { Command } from '@sapphire/framework';

export class PingCommand extends Command {
  public constructor(context: Command.Context, options: Command.Options) {
    super(context, {
      ...options,
      description: 'ping pong'
    });
  }

  public async messageRun(message: Message) {
    return message.channel.send(await fetchLanguage(message));
    // ===> en-US
  }
}
```
