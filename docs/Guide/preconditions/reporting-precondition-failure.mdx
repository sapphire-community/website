---
sidebar_position: 2
title: Reporting precondition failure
---

<<<<<<< HEAD
=======
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

>>>>>>> bce70940bf8edd1967c694d4ec08344839c08ecd
When a precondition fails, it's usually important for the user to know why. For example, if they hit a cooldown or lack
permissions, that should somehow be communicated. However, by default, nothing will happen if a precondition blocks a
message.

To change this, we'll need to create a `commandDenied` listener, which is triggered when a precondition fails. For more
information on how to create listeners, see the [`Creating Listeners`][listeners] section.

:::caution

The `commandDenied` event shouldn't be confused with the `commandError` event, which is triggered when a command throws
an error.

:::

`commandDenied` supplies the following information: the [`UserError`][error] that was created from the precondition, and
the [`CommandDeniedPayload`][payload], which includes necessary context.

<<<<<<< HEAD
```typescript ts2esm2cjs
=======
<Tabs groupId="language-choice">
<TabItem value="javascript" label="JavaScript" default>

```javascript
const { Listener } = require('@sapphire/framework');

module.exports = class CommandDeniedListener extends Listener {
  run(error, { message }) {
    // ...
  }
};
```

</TabItem>
<TabItem value="ESM" label="ESM">

```javascript
import { Listener } from '@sapphire/framework';

export class CommandDeniedListener extends Listener {
  run(error, { message }) {
    // ...
  }
}
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript
>>>>>>> bce70940bf8edd1967c694d4ec08344839c08ecd
import type { UserError, CommandDeniedPayload } from '@sapphire/framework';
import { Listener } from '@sapphire/framework';

export class CommandDeniedListener extends Listener {
  public run(error: UserError, { message }: CommandDeniedPayload) {
    // ...
  }
}
```

<<<<<<< HEAD
=======
</TabItem>
</Tabs>

>>>>>>> bce70940bf8edd1967c694d4ec08344839c08ecd
The `message` property of the `error` parameter will include the error message, as the name suggests. In [Creating
Preconditions][creating-preconditions], you can find that we defined this property within the `this.error()` method!

There are many possibilities for what you can do with the error, but the simplest is to just send it directly to the
user. That is what we'll do in this example:

<<<<<<< HEAD
```typescript ts2esm2cjs|{6}|{6}
import { Listener, UserError, CommandDeniedPayload } from '@sapphire/framework';
=======
<Tabs groupId="language-choice">
<TabItem value="javascript" label="JavaScript" default>

```javascript {5}
const { Listener } = require('@sapphire/framework');

module.exports = class CommandDeniedListener extends Listener {
  run(error, { message }) {
    return message.channel.send(error.message);
  }
};
```

</TabItem>
<TabItem value="ESM" label="ESM">

```javascript {5}
import { Listener } from '@sapphire/framework';

export class CommandDeniedListener extends Listener {
  run(error, { message }) {
    return message.channel.send(error.message);
  }
}
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript {6}
import type { UserError, CommandDeniedPayload } from '@sapphire/framework';
import { Listener } from '@sapphire/framework';
>>>>>>> bce70940bf8edd1967c694d4ec08344839c08ecd

export class CommandDeniedListener extends Listener {
  public run(error: UserError, { message }: CommandDeniedPayload) {
    return message.channel.send(error.message);
  }
}
```

<<<<<<< HEAD
=======
</TabItem>
</Tabs>

>>>>>>> bce70940bf8edd1967c694d4ec08344839c08ecd
## Ignoring Precondition Failures

If someone who isn't a bot owner tries to use a command intended only for the bot owner, sometimes you don't want to
send a message notifying them that they don't have permission. Instead, you'd rather let the command be blocked
silently. To do this, we can make use of the [`context`][context] property of `UserError`s. This property aims to
contain information about the context in which the error was thrown, and the value can be absolutely anything.

We can take advantage of this by adding `context: { silent: true }` to the [`this.error()`][preconditionerror] options.
We'll use the `OwnerOnly` precondition we made in [Creating Preconditions][creating-preconditions] to demonstrate this.

<<<<<<< HEAD
```typescript ts2esm2cjs|{9}|{9}
=======
<Tabs groupId="language-choice">
<TabItem value="javascript" label="JavaScript" default>

```javascript {9}
const { Precondition } = require('@sapphire/framework');

module.exports = class OwnerOnlyPrecondition extends Precondition {
  public run(message) {
    return message.author.id === 'YOUR_ID'
      ? this.ok()
      : this.error({
          message: 'Only the bot owner can use this command!'
          context: { silent: true }
        })
  }
};
```

</TabItem>
<TabItem value="ESM" label="ESM">

```javascript {9}
import { Precondition } from '@sapphire/framework';

export class OwnerOnlyPrecondition extends Precondition {
  public run(message) {
    return message.author.id === 'YOUR_ID'
      ? this.ok()
      : this.error({
          message: 'Only the bot owner can use this command!',
          context: { silent: true }
        })
  }
}
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript {9}
>>>>>>> bce70940bf8edd1967c694d4ec08344839c08ecd
import { Precondition, Message } from '@sapphire/framework';

export class OwnerOnlyPrecondition extends Precondition {
  public run(message: Message) {
    return message.author.id === 'YOUR_ID'
      ? this.ok()
      : this.error({
          message: 'Only the bot owner can use this command!'
          context: { silent: true }
        })
  }
}
```

<<<<<<< HEAD
=======
</TabItem>
</Tabs>

>>>>>>> bce70940bf8edd1967c694d4ec08344839c08ecd
We can then check if this property exists on the error in our listener, and ignore the failure if we find it.

<Tabs groupId="language-choice">
<TabItem value="javascript" label="JavaScript" default>

```javascript {5}
const { Listener } = require('@sapphire/framework');

module.exports = class CommandDeniedListener extends Listener {
  run(error, { message }) {
    if (error.context.silent) return;
    return message.channel.send(error.message);
  }
};
```

</TabItem>
<TabItem value="ESM" label="ESM">

```javascript {5}
import { Listener } from '@sapphire/framework';

export class CommandDeniedListener extends Listener {
  run(error, { message }) {
    if (error.context.silent) return;
    return message.channel.send(error.message);
  }
}
```

</TabItem>
<TabItem value="typescript" label="TypeScript">

```typescript {8}
import { UserError, CommandDeniedPayload, Listener } from '@sapphire/framework';

export class CommandDeniedListener extends Listener {
  public run(error: UserError, { message }: CommandDeniedPayload) {
    // A bit of a hack is required for TypeScript
    // Since `error.context` is of type `unknown`
    if (Reflect.get(Object(error.context), 'silent')) return;
    return message.channel.send(error.message);
  }
}
```

</TabItem>
</Tabs>

[listeners]: ../listeners/creating-your-own-listeners
[error]: ../../Documentation/api-framework/classes/UserError
[payload]: ../../Documentation/api-framework/interfaces/CommandDeniedPayload
[context]: ../../Documentation/api-framework/classes/UserError#context
[preconditionerror]: ../../Documentation/api-framework/classes/Precondition#error
[creating-preconditions]: ./creating-your-own-preconditions
